---
import "@fontsource-variable/onest";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "../styles/global.css";

interface Props {
  title: string;
  description: string;
}

const { description, title } = Astro.props;
const base = import.meta.env.BASE_URL;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width" />

    <!-- ✅ Para assets en /public sí usa base -->
    <!-- <link rel="icon" href={`${base}code.ico`} sizes="any" /> -->
     <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/10437/10437126.png" sizes="any" />

    <title>{title}</title>

    <!-- ✅ Init temprano de tema + idioma -->
    <script is:inline>
      (() => {
        // ====== THEME ======
        const getTheme = () => {
          const stored = localStorage.getItem("theme");
          if (stored === "dark" || stored === "light") return stored;
          return window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light";
        };

        const applyTheme = (theme) => {
          document.documentElement.classList.toggle("dark", theme === "dark");
          localStorage.setItem("theme", theme);
        };

        applyTheme(getTheme());

        window.toggleTheme = () => {
          const isDark = document.documentElement.classList.contains("dark");
          applyTheme(isDark ? "light" : "dark");
        };

        // ====== LANGUAGE ======
        window.changeLanguage = (lang) => {
          const safe = lang === "en" ? "en" : "es";
          localStorage.setItem("language", safe);
          document.documentElement.lang = safe;

          window.dispatchEvent(
            new CustomEvent("languageChange", { detail: { language: safe } }),
          );
        };

        document.documentElement.lang =
          localStorage.getItem("language") === "en" ? "en" : "es";
      })();
    </script>

    <!-- ✅ IMPORTANTE: scripts desde /src NO llevan base -->
    <script is:inline>
      // Los datos i18n incrustados
      const i18nData = {
        es: {
          nav_home: "Inicio",
          nav_experience: "Experiencia",
          nav_projects: "Proyectos",
          nav_about: "Sobre mí",
          nav_contact: "Contacto",
          status_available: "Disponible para trabajar",
          desc_part_1:
            "Desarrollador de software con 3 años de experiencia en Oracle Forms y Oracle Reports",
          desc_part_2: "y experiencia junior en desarrollo web.",
          desc_part_3: "De Santiago, República Dominicana.",
          desc_part_4:
            "Especializado en la creación de aplicaciones funcionales.",
          experience_title: "Experiencia laboral",
          welcome_title: "Hey, soy Misael",
          contact_title: "Contáctame",
          download_cv: "Descargar CV",
          section_experience_title: "Experiencia laboral",
          experience_title_1: "Desarrollador Oracle Forms y Reports",
          exp_more: "Saber más...",
          exp_1_date: "Actualmente...",
          exp_1_title: "Desarrollador Oracle Forms y Reports",
          exp_1_company: "Banfondesa",
          exp_1_desc:
            "Responsable del análisis, desarrollo y optimización de módulos internos utilizando Oracle Forms y Reports. Participación activa en la mejora continua de los sistemas financieros de la institución, realizando ajustes funcionales, correcciones y ampliaciones que garantizan la estabilidad y el rendimiento de las aplicaciones críticas.",
          exp_2_date: "Noviembre 2023 - Junio 2024",
          exp_2_title: "Desarrollador Oracle Forms y Reports",
          exp_2_company: "La Monumental de Seguros",
          exp_2_desc:
            "Desarrollé y mantuve aplicaciones orientadas a la gestión de pólizas, reclamaciones y procesos administrativos. Implementé mejoras funcionales y correcciones que aseguraron la operatividad diaria de los sistemas, trabajando con equipos internos para adaptar soluciones tecnológicas a las necesidades del negocio asegurador.",
          projects: "Proyectos",
          projects_subtitle: "Configurador de Bromas",
          proj_1_title: "Configurador de Bromas",
          proj_1_desc:
            "Proyecto enfocado en el consumo de una API REST pública (JokeAPI v2) para la obtención de chistes en tiempo real. Implementa peticiones HTTP, manejo de respuestas en formato JSON y filtrado por categorías y tipo de contenido.",
          proj_1_alt: "Captura de pantalla del proyecto Configurador de Bromas",
          btn_code: "Código",
          btn_preview: "Vista previa",
          tag_js: "JavaScript",
          tag_css: "CSS",
          tag_ejs: "EJS",
          aboutme_strong_1:
            "Soy un apasionado por la tecnología, el desarrollo de software y el aprendizaje constante",
          aboutme_text_1:
            ". Disfruto convertir ideas en soluciones funcionales, escribir código limpio y enfrentar retos que me obliguen a pensar diferente y mejorar cada día. Me gusta programar tanto como me gustan ",
          aboutme_strong_2:
            "los videojuegos, porque ambos me entrenan la mente: estrategia, lógica, paciencia y enfoque en resultados.",
          aboutme_strong_3: "El gym es parte clave de mi disciplina diaria;",
          aboutme_text_2:
            " me ayuda a mantener constancia, mentalidad fuerte y equilibrio entre mente y cuerpo, algo que también aplico en mis proyectos. Soy una persona curiosa, autodidacta y con mentalidad de crecimiento.",
          aboutme_text_3:
            "Siempre estoy aprendiendo nuevas tecnologías, buenas prácticas y formas más eficientes de hacer las cosas.",
          aboutme_strong_4:
            "Me adapto rápido, trabajo bien en equipo y me gusta aportar ideas que sumen valor real.",
        },
        en: {
          nav_home: "Home",
          nav_experience: "Experience",
          nav_projects: "Projects",
          nav_about: "About Me",
          nav_contact: "Contact",
          status_available: "Available for work",
          desc_part_1:
            "Software developer with 3 years of experience in Oracle Forms and Oracle Reports",
          desc_part_2: "and junior experience in web development.",
          desc_part_3: "From Santiago, Dominican Republic.",
          desc_part_4: "Specialized in creating functional applications.",
          experience_title: "Work Experience",
          welcome_title: "Hey, I'm Misael",
          contact_title: "Contact Me",
          download_cv: "Download CV",
          section_experience_title: "Work Experience",
          experience_title_1: "Oracle Forms and Reports Developer",
          exp_more: "Learn more...",
          exp_1_date: "Present...",
          exp_1_title: "Oracle Forms & Reports Developer",
          exp_1_company: "Banfondesa",
          exp_1_desc:
            "Responsible for analyzing, developing, and optimizing internal modules using Oracle Forms and Reports. Actively contributed to continuous improvement of the institution’s financial systems by delivering functional adjustments, fixes, and enhancements that ensure stability and performance for critical applications.",
          exp_2_date: "November 2023 - June 2024",
          exp_2_title: "Oracle Forms & Reports Developer",
          exp_2_company: "La Monumental Insurance",
          exp_2_desc:
            "Developed and maintained applications focused on policy management, claims, and administrative processes. Implemented functional improvements and fixes that ensured daily system operation, collaborating with internal teams to adapt technology solutions to business needs.",
          projects: "Projects",
          proj_1_title: "Jokes Configurator",
          proj_1_desc:
            "Project focused on the consumption of a public REST API (JokeAPI v2) to obtain jokes in real time. It implements HTTP requests, handles responses in JSON format, and filters by category and content type.",
          proj_1_alt: "Screenshot of the project Jokes Configurator",
          btn_code: "Code",
          btn_preview: "Preview",
          tag_js: "JavaScript",
          tag_css: "CSS",
          tag_ejs: "EJS",
          aboutme_strong_1:
            "I’m passionate about technology, software development, and continuous learning",
          aboutme_text_1:
            ". I enjoy turning ideas into functional solutions, writing clean code, and taking on challenges that push me to think differently and improve every day. I like programming as much as I like ",
          aboutme_strong_2:
            "video games, because both train my mind: strategy, logic, patience, and focus on results.",
          aboutme_strong_3: "The gym is a key part of my daily discipline;",
          aboutme_text_2:
            " it helps me stay consistent, mentally strong, and balanced between mind and body—something I also apply to my projects. I’m curious, self-taught, and growth-minded.",
          aboutme_text_3:
            "I’m always learning new technologies, best practices, and more efficient ways of doing things.",
          aboutme_strong_4:
            "I adapt quickly, work well in teams, and enjoy contributing ideas that add real value.",
        },
      };

      const getLang = () =>
        localStorage.getItem("language") === "en" ? "en" : "es";

      const loadDict = (lang) => i18nData[lang] || {};

      const applyTextI18n = (dict) => {
        document.querySelectorAll("[data-i18n]").forEach((el) => {
          const key = el.dataset.i18n;
          if (key && dict[key]) {
            el.textContent = dict[key];
          }
        });
      };

      const applyAttrI18n = (dict) => {
        document.querySelectorAll("[data-i18n-attr]").forEach((el) => {
          const attr = el.getAttribute("data-i18n-attr");
          if (!attr) return;

          const key = el.getAttribute(`data-i18n-${attr}`);
          if (key && dict[key]) {
            el.setAttribute(attr, dict[key]);
          }
        });
      };

      const applyI18n = (lang) => {
        const l = lang || getLang();
        document.documentElement.lang = l;
        const dict = loadDict(l);
        applyTextI18n(dict);
        applyAttrI18n(dict);
      };

      window.addEventListener("languageChange", (e) => {
        const l = e?.detail?.language === "en" ? "en" : "es";
        applyI18n(l);
      });

      const boot = () => applyI18n();

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", boot, { once: true });
      } else {
        boot();
      }

      document.addEventListener("astro:page-load", boot);
      document.addEventListener("astro:after-swap", boot);
    </script>
  </head>

  <body class="bg-gray-50 dark:bg-gray-950 min-h-screen flex flex-col">
    <div id="top"></div>

    <div
      class="fixed top-0 left-0 right-0 bottom-0 z-[-2]
      bg-[radial-gradient(ellipse_80%_80%_at_50%_-20%,rgba(217,216,255,0.5),rgba(255,255,255,0.9))]
      dark:bg-[radial-gradient(ellipse_80%_80%_at_50%_-20%,rgba(120,119,198,0.3),rgba(255,255,255,0))]"
    >
    </div>

    <Header />

    <main>
      <slot />
    </main>

    <Footer />
  </body>
</html>

<style is:global>
  :root {
    color-scheme: light dark;
  }
  html {
    font-family: "Onest Variable", sans-serif;
    scroll-behavior: smooth;
  }
  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }
</style>
