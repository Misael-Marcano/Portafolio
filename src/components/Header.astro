---
---

<header class="fixed top-0 z-50 flex items-center justify-center w-full mt-2">
  <nav
    id="main-nav"
    class="flex px-4 py-2 text-sm font-medium rounded-full justify-center items-center transition-all duration-300 gap-x-4 sm:gap-x-8 text-gray-700 dark:text-gray-300"
  >
    <a href="#top" data-i18n="nav_home" class="hover:text-blue-500 transition">Inicio</a>
    <a href="#experiencia" data-i18n="nav_experience" class="hover:text-blue-500 transition">Experiencia</a>
    <a href="#proyectos" data-i18n="nav_projects" class="hover:text-blue-500 transition">Proyectos</a>
    <a href="#sobremi" data-i18n="nav_about" class="hover:text-blue-500 transition">Sobre m√≠</a>
    <a href="#contacto" data-i18n="nav_contact" class="hover:text-blue-500 transition">Contacto</a>

    <div class="w-px h-5 bg-gray-400/50 dark:bg-gray-600/50"></div>

    <!-- Toggle de idioma -->
    <div class="flex bg-gray-200/50 dark:bg-gray-800/50 rounded-full p-1 border border-black/5 dark:border-white/10 relative h-8 w-24">
      <div id="lang-indicator" class="absolute top-1 bottom-1 w-[44px] bg-blue-500 rounded-full transition-all duration-300 ease-in-out shadow-sm" style="left: 4px;"></div>
      <button id="btn-es" type="button" class="relative z-10 w-1/2 text-[10px] font-bold transition-colors duration-300 text-white cursor-pointer">ES</button>
      <button id="btn-en" type="button" class="relative z-10 w-1/2 text-[10px] font-bold transition-colors duration-300 text-gray-700 dark:text-gray-400 cursor-pointer">EN</button>
    </div>

    <!-- Toggle de tema -->
    <button
      id="theme-toggle-btn"
      type="button"
      class="p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition cursor-pointer"
      aria-label="Cambiar tema"
    >
      <svg id="icon-sun" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="5" stroke-width="2"></circle>
        <path
          d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
          stroke-width="2"
        ></path>
      </svg>

      <svg id="icon-moon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
          stroke-width="2"
          stroke-linecap="round"
        ></path>
      </svg>
    </button>
  </nav>
</header>

<style>
  #main-nav {
    animation: nav-shadow 1s linear both;
    animation-timeline: scroll();
    animation-range: 0 100px;
  }

  #main-nav a.active {
    color: #3b82f6;
    font-weight: 600;
  }
  :global(.dark) #main-nav a.active {
    color: #60a5fa;
  }

  @keyframes nav-shadow {
    from { background-color: transparent; }
    to {
      background-color: rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 6px 20px;
    }
  }

  :global(.dark) #main-nav {
    animation: nav-shadow-dark 1s linear both;
    animation-timeline: scroll();
    animation-range: 0 100px;
  }

  @keyframes nav-shadow-dark {
    from { background-color: transparent; }
    to {
      background-color: rgba(17, 24, 39, 0.5);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 6px 20px;
    }
  }
</style>

<script is:inline>
  const initHeaderControls = () => {
    const themeBtn = document.getElementById("theme-toggle-btn");
    const btnEs = document.getElementById("btn-es");
    const btnEn = document.getElementById("btn-en");
    const indicator = document.getElementById("lang-indicator");

    if (!themeBtn || !btnEs || !btnEn || !indicator) return;

    const paintLangIndicator = () => {
      const currentLang = localStorage.getItem("language") === "en" ? "en" : "es";

      if (currentLang === "es") {
        indicator.style.left = "4px";
        btnEs.classList.add("text-white");
        btnEs.classList.remove("text-gray-700", "dark:text-gray-400");

        btnEn.classList.remove("text-white");
        btnEn.classList.add("text-gray-700", "dark:text-gray-400");
      } else {
        indicator.style.left = "46px";
        btnEn.classList.add("text-white");
        btnEn.classList.remove("text-gray-700", "dark:text-gray-400");

        btnEs.classList.remove("text-white");
        btnEs.classList.add("text-gray-700", "dark:text-gray-400");
      }
    };

    // Scroll-spy
    const links = Array.from(document.querySelectorAll('#main-nav a[href^="#"]'));

    const getSections = () =>
      links
        .map((a) => {
          const href = a.getAttribute("href");
          if (!href) return null;
          const el = document.querySelector(href);
          return el ? { a, el, href } : null;
        })
        .filter(Boolean);

    let sections = getSections();

    const setActiveLink = () => {
      if (!sections.length) sections = getSections();

      const offset = 160;
      let currentHref = "#top";

      for (const s of sections) {
        const rect = s.el.getBoundingClientRect();
        if (rect.top <= offset) currentHref = s.href;
      }

      links.forEach((a) => a.classList.toggle("active", a.getAttribute("href") === currentHref));
    };

    // Eventos
    themeBtn.addEventListener("click", () => {
      if (typeof window.toggleTheme === "function") window.toggleTheme();
    });

    btnEs.addEventListener("click", () => {
      if (typeof window.changeLanguage === "function") window.changeLanguage("es");
      paintLangIndicator();
    });

    btnEn.addEventListener("click", () => {
      if (typeof window.changeLanguage === "function") window.changeLanguage("en");
      paintLangIndicator();
    });

    window.addEventListener("languageChange", paintLangIndicator);
    window.addEventListener("scroll", setActiveLink, { passive: true });

    paintLangIndicator();
    setActiveLink();
  };

  if (document.readyState === "loading") {
    window.addEventListener("load", initHeaderControls, { once: true });
  } else {
    initHeaderControls();
  }
</script>
